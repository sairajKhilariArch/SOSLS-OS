<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
    <title>
      GRUB-2.12 for EFI
    </title>
    <link rel="stylesheet" type="text/css" href="../stylesheets/lfs.css" />
    <meta name="generator" content="DocBook XSL-NS Stylesheets Vsnapshot" />
    <link rel="stylesheet" href="../stylesheets/lfs-print.css" type=
    "text/css" media="print" />
  </head>
  <body class="blfs" id="blfs-12.4">
    <div class="navheader">
      <h4>
        Beyond Linux<sup>®</sup> From Scratch <span class="phrase">(System
        V</span> Edition) - Version 12.4
      </h4>
      <h3>
        Chapter&nbsp;5.&nbsp;File Systems and Disk Management
      </h3>
      <ul>
        <li class="prev">
          <a accesskey="p" href="efibootmgr.html" title=
          "efibootmgr-18">Prev</a>
          <p>
            efibootmgr-18
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="grub-setup.html" title=
          "Using GRUB to Set Up the Boot Process with UEFI">Next</a>
          <p>
            Using GRUB to Set Up the Boot Process with UEFI
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="filesystems.html" title=
          "Chapter&nbsp;5.&nbsp;File Systems and Disk Management">Up</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Beyond Linux® From Scratch    (System V Edition) - Version 12.4">Home</a>
        </li>
      </ul>
    </div>
    <h1 class="sect1">
      <a id="grub-efi" name="grub-efi"></a>GRUB-2.12 for EFI
    </h1>
    <div class="sect1" lang="en" xml:lang="en">
      <div class="package" lang="en" xml:lang="en">
        <h2 class="sect2">
          Introduction to GRUB
        </h2>
        <p>
          The <span class="application">GRUB</span> package provides GRand
          Unified Bootloader. In this page it will be built with UEFI
          support, which is not enabled for GRUB built in LFS.
        </p>
        <p>
          This package is known to build and work properly using an LFS 12.4
          platform.
        </p>
        <h3>
          Package Information
        </h3>
        <div class="itemizedlist">
          <ul class="compact">
            <li class="listitem">
              <p>
                Download (HTTP): <a class="ulink" href=
                "https://ftp.gnu.org/gnu/grub/grub-2.12.tar.xz">https://ftp.gnu.org/gnu/grub/grub-2.12.tar.xz</a>
              </p>
            </li>
            <li class="listitem">
              <p>
                Download MD5 sum: 60c564b1bdc39d8e43b3aab4bc0fb140
              </p>
            </li>
            <li class="listitem">
              <p>
                Download size: 29 MB
              </p>
            </li>
            <li class="listitem">
              <p>
                Estimated disk space required: 174 MB (with optional
                dependencies and download)
              </p>
            </li>
            <li class="listitem">
              <p>
                Estimated build time: 0.6 SBU
              </p>
            </li>
          </ul>
        </div>
        <h3>
          Additional Downloads
        </h3>
        <div class="itemizedlist">
          <p class="title">
            <strong>Optional Unicode font data for the GRUB menu (only useful
            if FreeType is installed)</strong>
          </p>
          <ul class="compact">
            <li class="listitem">
              <p>
                Download (HTTP): <a class="ulink" href=
                "https://unifoundry.com/pub/unifont/unifont-16.0.04/font-builds/unifont-16.0.04.pcf.gz">
                https://unifoundry.com/pub/unifont/unifont-16.0.04/font-builds/unifont-16.0.04.pcf.gz</a>
              </p>
            </li>
            <li class="listitem">
              <p>
                Download MD5 sum: a4b7ab627d341ddd4f9096ef947757bf
              </p>
            </li>
            <li class="listitem">
              <p>
                Download size: 1.3 MB
              </p>
            </li>
          </ul>
        </div>
        <h3>
          GRUB Dependencies
        </h3>
        <h4>
          Recommended
        </h4>
        <p class="recommended">
          <a class="xref" href="efibootmgr.html" title=
          "efibootmgr-18">efibootmgr-18</a> (runtime)
        </p>
        <h4>
          Optional
        </h4>
        <p class="optional">
          <a class="xref" href="../general/freetype2.html" title=
          "FreeType-2.13.3">FreeType-2.13.3</a>, <a class="xref" href=
          "fuse.html" title="Fuse-3.17.4">Fuse-3.17.4</a>, and <a class=
          "xref" href="lvm2.html" title="LVM2-2.03.34">LVM2-2.03.34</a>
        </p>
        <p class="nodep">
          If you are building GRUB for a 32-bit LFS system to boot it on a
          64-bit UEFI firmware, rebuild <a class="xref" href=
          "../general/gcc.html" title="GCC-15.2.0">GCC-15.2.0</a> with the
          <em class="parameter"><code>--enable-targets=all</code></em> switch
          appended to the <span class=
          "command"><strong>../configure</strong></span> command.
        </p>
      </div>
      <div class="installation" lang="en" xml:lang="en">
        <h2 class="sect2">
          Installation of GRUB
        </h2>
        <p>
          First, install font data as the <code class=
          "systemitem">root</code> user if you've downloaded it and you've
          installed the optional dependency <a class="xref" href=
          "../general/freetype2.html" title=
          "FreeType-2.13.3">FreeType-2.13.3</a>:
        </p>
        <pre class="root"><kbd class=
        "command">mkdir -pv /usr/share/fonts/unifont &amp;&amp;
gunzip -c ../unifont-16.0.04.pcf.gz &gt; /usr/share/fonts/unifont/unifont.pcf</kbd></pre>
        <div class="admon warning">
          <img alt="[Warning]" src="../images/warning.png" />
          <h3>
            Warning
          </h3>
          <p>
            Unset any environment variables which may affect the build:
          </p>
          <pre class="userinput"><kbd class=
          "command">unset {C,CPP,CXX,LD}FLAGS</kbd></pre>
          <p>
            Don't try <span class="quote">“<span class=
            "quote">tuning</span>”</span> this package with custom
            compilation flags: this package is a bootloader, with low-level
            operations in the source code which is likely to be broken by
            some aggressive optimizations.
          </p>
        </div>
        <p>
          Add a file missing from the release tarball:
        </p>
        <pre class="userinput"><kbd class="command">echo <code class=
        "literal">depends bli part_gpt</code> &gt; grub-core/extra_deps.lst</kbd></pre>
        <p>
          Build <span class="application">GRUB</span> with the following
          commands:
        </p>
        <pre class="userinput"><kbd class=
        "command">./configure --prefix=/usr        \
            --sysconfdir=/etc    \
            --disable-efiemu     \
            --with-platform=efi  \
            --target=x86_64      \
            --disable-werror     &amp;&amp;
make</kbd></pre>
        <p>
          This package does not have a test suite providing meaningful
          results.
        </p>
        <p>
          Now, if you've skipped the LFS GRUB package, as the <code class=
          "systemitem">root</code> user install GRUB and skip the remaining
          instructions in this section:
        </p>
        <pre class="userinput"><kbd class="command">make install &amp;&amp;
mv -v /etc/bash_completion.d/grub /usr/share/bash-completion/completions</kbd></pre>
        <p>
          If you've not skipped LFS GRUB package, as the <code class=
          "systemitem">root</code> user, only install the components not
          installed from the LFS GRUB package instead:
        </p>
        <pre class="root"><kbd class=
        "command">make -C grub-core install</kbd></pre>
        <p>
          If you've installed the optional font data and <a class="xref"
          href="../general/freetype2.html" title=
          "FreeType-2.13.3">FreeType-2.13.3</a>, install the <span class=
          "command"><strong>grub-mkfont</strong></span> program and the font
          data files (without the font data files GRUB can still function
          normally, but the boot menu will be displayed using a coarse font
          or in a smaller region on the screen).
        </p>
        <pre class="userinput"><kbd class=
        "command">install -vm755 grub-mkfont /usr/bin/ &amp;&amp;
install -vm644 ascii.h widthspec.h *.pf2 /usr/share/grub/</kbd></pre>
        <p>
          If both <a class="xref" href="fuse.html" title=
          "Fuse-3.17.4">Fuse-3.17.4</a> and <a class="xref" href="lvm2.html"
          title="LVM2-2.03.34">LVM2-2.03.34</a> are installed, also install
          the <span class="command"><strong>grub-mount</strong></span>
          program:
        </p>
        <pre class="userinput"><kbd class=
        "command">install -vm755 grub-mount /usr/bin/</kbd></pre>
      </div>
      <div class="commands" lang="en" xml:lang="en">
        <h2 class="sect2">
          Command Explanations
        </h2>
        <p>
          <em class="parameter"><code>--with-platform=efi</code></em>:
          Ensures building GRUB with EFI enabled.
        </p>
        <p>
          <em class="parameter"><code>--target=x86_64</code></em>: Ensures
          building GRUB for x86_64 even if building on a 32-bit LFS system.
          Most EFI firmware on x86_64 does not support 32-bit bootloaders.
        </p>
        <p>
          <code class="option">--target=i386</code>: A few 32-bit x86
          platforms have EFI support. And, some x86_64 platforms have a
          32-bit EFI implementation, but they are very old and rare. Use this
          instead of <em class="parameter"><code>--target=x86_64</code></em>
          if you are <span class="bold"><strong>absolutely
          sure</strong></span> that LFS is running on such a system.
        </p>
      </div>
      <div class="sect2" lang="en" xml:lang="en">
        <h2 class="sect2">
          Configuring GRUB
        </h2>
        <p>
          Using GRUB to make the LFS system bootable on UEFI platform will be
          discussed in <a class="xref" href="grub-setup.html" title=
          "Using GRUB to Set Up the Boot Process with UEFI">Using GRUB to Set
          Up the Boot Process with UEFI</a>.
        </p>
      </div>
      <div class="content" lang="en" xml:lang="en">
        <h2 class="sect2">
          Contents
        </h2>
        <p>
          A list of the installed files, along with their short descriptions
          can be found at <a class="ulink" href=
          "../../../../lfs/view/12.4/chapter08/grub.html#contents-gRUB">../../../../lfs/view/12.4/chapter08/grub.html#contents-gRUB</a>.
        </p>
        <p>
          Listed below are the newly installed programs along with short
          descriptions.
        </p>
        <div class="segmentedlist">
          <div class="seglistitem">
            <div class="seg">
              <strong class="segtitle">Installed Programs:</strong>
              <span class="segbody">grub-mkfont and grub-mount
              (optional)</span>
            </div>
            <div class="seg">
              <strong class="segtitle">Installed Directories:</strong>
              <span class="segbody">/usr/lib/grub/x86_64-efi</span>
            </div>
          </div>
        </div>
        <div class="variablelist">
          <h3>
            Short Descriptions
          </h3>
          <table border="0" class="variablelist">
            <colgroup>
              <col align="left" valign="top" />
              <col />
            </colgroup>
            <tbody>
              <tr>
                <td>
                  <p>
                    <a id="grub-mkfont" name="grub-mkfont"></a><span class=
                    "term"><span class=
                    "command"><strong>grub-mkfont</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    converts common font file formats into PF2
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="grub-mount" name="grub-mount"></a><span class=
                    "term"><span class=
                    "command"><strong>grub-mount</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    is a debug tool for filesystem driver
                  </p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="efibootmgr.html" title=
          "efibootmgr-18">Prev</a>
          <p>
            efibootmgr-18
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="grub-setup.html" title=
          "Using GRUB to Set Up the Boot Process with UEFI">Next</a>
          <p>
            Using GRUB to Set Up the Boot Process with UEFI
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="filesystems.html" title=
          "Chapter&nbsp;5.&nbsp;File Systems and Disk Management">Up</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Beyond Linux® From Scratch    (System V Edition) - Version 12.4">Home</a>
        </li>
      </ul>
    </div>
  </body>
</html>
